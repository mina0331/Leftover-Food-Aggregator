{% extends "base.html" %}
{% block title %}Friends - UVA Leftovers{% endblock %}

{% block content %}
<div class="find-friends-container" style="max-width:900px;margin:40px auto;padding:30px;background:#fff;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.1);">
  <h1 style="margin-bottom:6px;">ðŸ‘¥ Friends</h1>
  <p style="color:#666;margin-top:0;">
    {{ counts.friends }} friends â€¢ {{ counts.received }} incoming â€¢ {{ counts.sent }} outgoing
  </p>

  {% if messages %}
    {% for message in messages %}
      <div style="padding:12px;margin:12px 0;border-radius:8px;background:#e3f2fd;border:1px solid #90caf9;">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <h3 style="margin-top:24px;">Current Friends</h3>
  {% if friends %}
    <ul class="users-list" style="list-style:none;padding:0;margin:0;">
      {% for u in friends %}
        <li class="user-item" style="display:flex;justify-content:space-between;align-items:center;border:1px solid #e0e0e0;border-radius:8px;padding:14px;margin:10px 0;">
          <div>
            <div class="user-name" style="font-weight:600;color:#10172A;">{{ u.username }}</div>
            <div class="user-email" style="font-size:13px;color:#666;">{{ u.email }}</div>
          </div>
          <form method="post" action="{% url 'chat:remove_friend' u.id %}">
            {% csrf_token %}
            <button class="action-btn btn-pending" style="background:#999;color:#fff;border:none;border-radius:6px;padding:8px 14px;cursor:pointer;">
              Remove
            </button>
          </form>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p style="color:#999;">You donâ€™t have any friends yet.</p>
  {% endif %}

  <h3 style="margin-top:32px;">Incoming Requests</h3>
  {% if received_reqs %}
    <ul class="users-list" style="list-style:none;padding:0;margin:0;">
      {% for r in received_reqs %}
        <li class="user-item" style="display:flex;justify-content:space-between;align-items:center;border:1px solid #e0e0e0;border-radius:8px;padding:14px;margin:10px 0;">
          <div>
            <div class="user-name" style="font-weight:600;color:#10172A;">{{ r.from_user.username }}</div>
            <div class="user-email" style="font-size:13px;color:#666;">{{ r.from_user.email }}</div>
          </div>
          <div>
            <form method="post" action="{% url 'chat:accept_friend_request' r.id %}" style="display:inline;">
              {% csrf_token %}
              <button class="action-btn btn-add" style="background:#E57200;color:#fff;border:none;border-radius:6px;padding:8px 14px;cursor:pointer;">Accept</button>
            </form>
            <form method="post" action="{% url 'chat:reject_friend_request' r.id %}" style="display:inline;margin-left:6px;">
              {% csrf_token %}
              <button class="action-btn btn-message" style="background:#10172A;color:#fff;border:none;border-radius:6px;padding:8px 14px;cursor:pointer;">Reject</button>
            </form>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p style="color:#999;">No incoming requests.</p>
  {% endif %}

  <h3 style="margin-top:32px;">Outgoing Requests</h3>
  {% if sent_reqs %}
    <ul class="users-list" style="list-style:none;padding:0;margin:0;">
      {% for r in sent_reqs %}
        <li class="user-item" style="display:flex;justify-content:space-between;align-items:center;border:1px solid #e0e0e0;border-radius:8px;padding:14px;margin:10px 0;">
          <div>
            <div class="user-name" style="font-weight:600;color:#10172A;">{{ r.to_user.username }}</div>
            <div class="user-email" style="font-size:13px;color:#666;">{{ r.to_user.email }}</div>
          </div>
          <form method="post" action="{% url 'chat:cancel_friend_request' r.id %}">
            {% csrf_token %}
            <button class="action-btn btn-pending" style="background:#999;color:#fff;border:none;border-radius:6px;padding:8px 14px;cursor:pointer;">Cancel</button>
          </form>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p style="color:#999;">No outgoing requests.</p>
  {% endif %}
</div>
{% endblock %}

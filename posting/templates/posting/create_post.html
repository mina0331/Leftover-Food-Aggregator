{% extends "base.html" %}
{% load static %}

{% block title %}Create Post | UVA Leftovers{% endblock %}

{% block content %}
<div style="max-width:650px; margin:50px auto; background:#fff; border-radius:12px;
            box-shadow:0 4px 12px rgba(0,0,0,0.08); padding:32px;">

  <h1 style="text-align:center; color:#232D4B; margin-bottom:24px;">
    üç± Create a New Food Post
  </h1>

  <form method="post" enctype="multipart/form-data" style="display:flex; flex-direction:column; gap:18px;">
    {% csrf_token %}
    
    {% for field in form %}
  {% if field.name == "image" %}
    <div style="display:flex; flex-direction:column;">
      <label style="font-weight:bold; color:#232D4B; margin-bottom:6px;">
        {{ field.label }}
      </label>

      <!-- Clickable "text-like" area that opens the file picker -->
      <div id="imageDisplay"
           onclick="document.getElementById('imageInput').click();"
           style="
             padding: 10px 12px;
             border-radius: 8px;
             border: 1px solid #ccc;
             background: #f9fafb;
             font-size: 14px;
             color: #555;
             cursor: pointer;
           ">
        <span id="imageDisplayText">Click to upload an image</span>
      </div>

      <!-- Hidden actual file input -->
      {{ field }}

      <!-- Optional preview -->
      <img id="imagePreview"
           src=""
           style="display:none; margin-top:10px; max-width:100%; border-radius:8px;">

      {% for error in field.errors %}
        <p style="color:#b30000; margin:4px 0;">{{ error }}</p>
      {% endfor %}
    </div>

  {% elif field.name != "publish_at" %}
    <div style="display:flex; flex-direction:column;">
      <label for="{{ field.id_for_label }}" 
             style="font-weight:bold; color:#232D4B; margin-bottom:6px;">
        {{ field.label }}
      </label>
      {{ field }}
      {% if field.help_text %}
        <small style="color:#777;">{{ field.help_text }}</small>
      {% endif %}
      {% for error in field.errors %}
        <p style="color:#b30000; margin:4px 0;">{{ error }}</p>
      {% endfor %}
    </div>
  {% endif %}
{% endfor %}


    <!-- Schedule for later checkbox -->
    <div style="display:flex; align-items:center; gap:8px;">
      <input type="checkbox" id="scheduleCheckbox" 
             style="width:18px; height:18px; cursor:pointer;">
      <label for="scheduleCheckbox" 
             style="font-weight:bold; color:#232D4B; cursor:pointer;">
        Schedule for later
      </label>
    </div>

    <!-- Datetime picker (hidden by default) -->
    <div id="scheduleContainer" style="display:none; flex-direction:column;">
      <label for="publish_at" 
             style="font-weight:bold; color:#232D4B; margin-bottom:6px;">
        Publish at
      </label>
      <input type="datetime-local" id="publish_at" name="publish_at"
             style="padding:8px; border:1px solid #ccc; border-radius:4px; font-size:14px;">
      <small style="color:#777; margin-top:4px;">
        Select the date and time when this post should be published
      </small>
    </div>

    <button type="submit" 
            style="background:#E57200; color:white; border:none; border-radius:8px;
                   padding:10px 16px; font-size:16px; cursor:pointer;
                   transition:background .2s ease;">
      Create Post
    </button>
  </form>

  <p style="text-align:center; margin-top:24px;">
    <a href="{% url 'posting:post_list' %}" 
       style="color:#232D4B; text-decoration:none; font-weight:bold;">
       ‚Üê Back to Posts
    </a>
  </p>
</div>

<script>
  // Toggle datetime picker visibility when checkbox is checked
  const scheduleCheckbox = document.getElementById('scheduleCheckbox');
  const scheduleContainer = document.getElementById('scheduleContainer');
  const publishAtInput = document.getElementById('publish_at');

  scheduleCheckbox.addEventListener('change', function() {
    if (this.checked) {
      scheduleContainer.style.display = 'flex';
      publishAtInput.required = true;
    } else {
      scheduleContainer.style.display = 'none';
      publishAtInput.required = false;
      publishAtInput.value = ''; // Clear the value when unchecked
    }
  });
</script>

<script>
  const imageInput = document.getElementById('imageInput');
  const imageDisplayText = document.getElementById('imageDisplayText');
  const imagePreview = document.getElementById('imagePreview');

  if (imageInput) {
    imageInput.addEventListener('change', (e) => {
      const [file] = e.target.files || [];
      if (file) {
        // Show file name in the "text-like" field
        imageDisplayText.textContent = file.name;

        // Optional: preview the image
        if (imagePreview) {
          imagePreview.src = URL.createObjectURL(file);
          imagePreview.style.display = 'block';
        }
      } else {
        imageDisplayText.textContent = "Click to upload an image";
        if (imagePreview) {
          imagePreview.src = "";
          imagePreview.style.display = 'none';
        }
      }
    });
  }
</script>

{% endblock %}

{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container" style="max-width: 800px; margin: 40px auto;">

  <a href="{% url 'posting:post_list' %}"
     style="text-decoration:none; color:#232D4B; font-weight:bold;">
     ‚Üê Back to All Posts
  </a>

  <div style="border:1px solid #ddd; border-radius:12px; padding:24px; margin-top:20px;
              box-shadow:0 2px 6px rgba(0,0,0,0.05); background:white;">

    <h1 style="margin-top:0; color:#232D4B;">{{ post.event }}</h1>

    <p style="color:#555;">
      <strong>Created by:</strong> {{ post.author.username }}<br>
      <strong>Date:</strong> {{ post.created_at|date:"M d, Y" }}<br>
      <strong>Cuisine:</strong> {{ post.get_cuisine_display }}
    </p>

    {% if post.image %}
      <img src="{{ post.image.url }}" alt="{{ post.event }}"
           style="width:100%; border-radius:12px; margin:20px 0;">
    {% endif %}

    <h3 style="color:#232D4B;">Event Description</h3>
    <p style="line-height:1.6; color:#333;">
      {{ post.event_description|linebreaks }}
    </p>

    <div style="margin-top:20px; display: flex; gap: 10px; align-items: center;">
      {% if user == post.author %}
        <a href="{% url 'posting:edit_post' post.id %}"
           style="background:#E57200; color:white; padding:8px 14px;
                  border-radius:6px; text-decoration:none;">Edit</a>
        <a href="{% url 'posting:delete_post' post.id %}"
           style="background:#b30000; color:white; padding:8px 14px;
                  border-radius:6px; text-decoration:none;">Delete</a>
      {% endif %}
      <div style="display:flex; gap:10px; align-items:center;">
        {% if user.is_authenticated and user != post.author %}
          <button onclick="openFlagModal({{ post.id }})"
                  style="background:#e74c3c; color:white; border:none; padding:8px 14px;
                         border-radius:6px; cursor:pointer; font-size:14px;"
                  title="Flag this post for moderator review" aria-label="Flag post">
            üö© Flag Post
          </button>
      
          <a href="{% url 'posting:report_post' post.id %}"
             style="background:#E57200; color:white; padding:8px 14px;
                    border-radius:6px; text-decoration:none; font-size:14px;"
             title="Report a food safety issue" aria-label="Report food issue">
            ‚ö†Ô∏è Report Food Issue
          </a>
        {% endif %}
      </div>
      
    </div>
      <h2>{{ post.event }}</h2>
  <p>{{ post.event_description }}</p>

  {% if post.qr_code_image %}
      <img src="{{ post.qr_code_image.url }}" alt="QR Code for {{ post.event }}">
  {% endif %}

  </div>

</div>

<script>
function openFlagModal(postId) {
    const reason = prompt('Please provide a reason for flagging this post:');
    if (reason && reason.trim()) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '{% url "moderation:flag_content" %}';
        
        const csrf = document.createElement('input');
        csrf.type = 'hidden';
        csrf.name = 'csrfmiddlewaretoken';
        csrf.value = '{{ csrf_token }}';
        form.appendChild(csrf);
        
        const contentType = document.createElement('input');
        contentType.type = 'hidden';
        contentType.name = 'content_type_id';
        contentType.value = '{{ post_content_type_id|default:"" }}';
        form.appendChild(contentType);
        
        const objectId = document.createElement('input');
        objectId.type = 'hidden';
        objectId.name = 'object_id';
        objectId.value = postId;
        form.appendChild(objectId);
        
        const reasonInput = document.createElement('input');
        reasonInput.type = 'hidden';
        reasonInput.name = 'reason';
        reasonInput.value = reason.trim();
        form.appendChild(reasonInput);
        
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}
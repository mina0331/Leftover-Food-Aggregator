{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container" style="max-width: 900px; margin: 40px auto;">
  <a href="{% url 'posting:post_detail' post.id %}"
     style="text-decoration:none; color:#232D4B; font-weight:bold;">
     ← Back to Post
  </a>

  <div style="border:1px solid #ddd; border-radius:12px; padding:24px; margin-top:20px;
              box-shadow:0 2px 6px rgba(0,0,0,0.05); background:white;">
    <h1 style="margin-top:0; color:#232D4B;">RSVPs for "{{ post.event }}"</h1>
    
    <p style="color:#555; margin-bottom:20px;">
      <strong>Total Active RSVPs:</strong> {{ active_rsvps.count }}
    </p>

    <!-- Active RSVPs -->
    {% if active_rsvps %}
      <h2 style="color:#232D4B; margin-top:30px; margin-bottom:15px;">Active RSVPs</h2>
      <div style="display:flex; flex-direction:column; gap:15px;">
        {% for rsvp in active_rsvps %}
          <div style="border:1px solid #4caf50; border-left:4px solid #4caf50; 
                      padding:15px; border-radius:6px; background:#f1f8f4;">
            <div style="display:flex; justify-content:space-between; align-items:start;">
              <div style="flex:1;">
                <p style="margin:0 0 8px 0; color:#333; font-weight:600;">
                  {{ rsvp.user.profile.display_name|default:rsvp.user.username }}
                </p>
                <p style="margin:0 0 4px 0; color:#555; font-size:0.9rem;">
                  <strong>Estimated arrival:</strong> {{ rsvp.estimated_arrival_minutes }} minutes
                </p>
                <p style="margin:0 0 4px 0; color:#555; font-size:0.9rem;">
                  <strong>RSVP'd at:</strong> {{ rsvp.created_at|date:"M d, Y g:i A" }}
                </p>
                <p style="margin:0 0 4px 0; color:#555; font-size:0.9rem;">
                  <strong>Expected arrival:</strong> {{ rsvp.get_estimated_arrival_time|date:"M d, Y g:i A" }}
                </p>
                <p style="margin:8px 0 0 0; color:#4caf50; font-size:0.9rem; font-weight:600;">
                  ⏱️ {{ rsvp.get_time_remaining }} remaining
                </p>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p style="color:#666; font-style:italic;">No active RSVPs yet.</p>
    {% endif %}

    <!-- Cancelled RSVPs -->
    {% if cancelled_rsvps %}
      <h2 style="color:#232D4B; margin-top:40px; margin-bottom:15px;">Cancelled RSVPs</h2>
      <div style="display:flex; flex-direction:column; gap:15px;">
        {% for rsvp in cancelled_rsvps %}
          <div style="border:1px solid #ccc; border-left:4px solid #95a5a6; 
                      padding:15px; border-radius:6px; background:#f5f5f5; opacity:0.7;">
            <div style="display:flex; justify-content:space-between; align-items:start;">
              <div style="flex:1;">
                <p style="margin:0 0 8px 0; color:#333; font-weight:600;">
                  {{ rsvp.user.profile.display_name|default:rsvp.user.username }}
                </p>
                <p style="margin:0 0 4px 0; color:#666; font-size:0.9rem;">
                  <strong>Cancelled at:</strong> {{ rsvp.cancelled_at|date:"M d, Y g:i A" }}
                </p>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}


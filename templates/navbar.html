{% load static %}
{% with p=request.path %}
<nav style="width:100%; background:#232D4B; color:#fff; padding:10px 16px; box-sizing:border-box; position:relative; z-index:1000;">
  <style>
    .nav-inner{
      display:flex;
      align-items:center;
      gap:16px;
      position:relative; /* for absolute center */
    }

    .nav-left{
      display:flex;
      align-items:center;
      gap:10px;
    }

    /* Center tabs centered relative to full navbar */
    .nav-center{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      display:flex;
      justify-content:center;
      pointer-events:auto;
    }

    .nav-right{
      display:flex;
      gap:1px;
      align-items:center;
      margin-left:auto;
    }

    .nav-list{
      list-style:none;
      display:flex;
      gap:18px;
      margin:0;
      padding:0;
      align-items:center;
      flex-wrap:wrap;
    }

    /* Brand */
    .brand{
      display:inline-flex;
      align-items:center;
      gap:10px;
      text-decoration:none;
      padding:6px 10px;
      border-radius:6px;
      color:#fff;
      position:relative;
      transition:transform .2s, opacity .2s, color .2s;
    }

    .nav-link{
      display:inline-block;
      text-decoration:none;
      padding:6px 10px;
      border-radius:6px;
      color:#fff;
      position:relative;
      transition:transform .2s, opacity .2s, color .2s;
    }

    .nav-link:hover, .brand:hover{
      transform:translateY(-3px);
      opacity:.9;
    }

    .nav-link::after, .brand::after{
      content:"";
      position:absolute;
      left:0;
      bottom:-2px;
      height:3px;
      width:0;
      background:#E57200;
      transition:width .25s;
    }

    .nav-link:hover::after, .brand:hover::after{
      width:100%;
    }

    .active-link{
      color:#E57200 !important;
      font-weight:bold;
    }
    .active-link::after{
      width:100%;
    }

    .badge{
      background:#E57200;
      color:#fff;
      border-radius:10px;
      padding:2px 6px;
      font-size:12px;
      margin-left:6px;
    }

    @media (max-width: 900px){
      .nav-center{
        left:0;
        transform:none;
      }
    }
  </style>


  <div class="nav-inner">

    <!-- LEFT: Brand -->
    <div class="nav-left">
      <a href="/" class="brand {% if p == '/' %}active-link{% endif %}">
        <img src="{% static 'img/image.png' %}" alt="UVA Leftovers Logo"
             style="height:28px;width:28px;object-fit:contain;">
        <span style="font-weight:700; letter-spacing:.3px;">UVA Leftovers</span>
      </a>
    </div>

    <!-- CENTER NAV -->
    {% url 'posting:post_list' as posts_url %}
    <div class="nav-center">
      <ul class="nav-list">

        {# NOTE: Profile moved to nav-right #}

        {% if user.is_authenticated %}
          {% with role=user.profile.role %}
            {% if role == 'student' %}
              <li>
                <a href="{{ posts_url }}"
                   class="nav-link {% if p == posts_url or '/student' in p %}active-link{% endif %}">
                  Food Listings
                </a>
                {% if unread_posts_count %}
                  <span class="badge">{{ unread_posts_count }}</span>
                {% endif %}
              </li>
            {% elif role == 'org' %}
              <li>
                <a href="{{ posts_url }}"
                   class="nav-link {% if p == posts_url or '/provider' in p %}active-link{% endif %}">
                  Post Listings
                </a>
              </li>
            {% endif %}
          {% endwith %}
        {% endif %}

        {% url 'posting:event_history' as history_url %}
        <li>
          <a href="{{ history_url }}"
             class="nav-link {% if '/posts/history' in p %}active-link{% endif %}">
             Event History
          </a>
        </li>

        <li>
          {% url 'chat:index' as chat_url %}
          <a href="{{ chat_url }}"
             class="nav-link {% if p|slice:':6' == '/chat/' or p|slice:':9' == '/chat/' %}active-link{% endif %}">
             Chat
          </a>
          {% if unread_count %}
            <span class="badge">{{ unread_count }}</span>
          {% endif %}
        </li>

        <li>
          {% url 'friends:friends_list' as friends_url %}
          <a href="{{ friends_url }}"
             class="nav-link {% if p|slice:':9' == '/friends/' %}active-link{% endif %}">
             Friends
          </a>
          {% if pending_friend_requests_count %}
            <span class="badge">{{ pending_friend_requests_count }}</span>
          {% endif %}
        </li>


      </ul>
    </div>

    <!-- RIGHT: Export (admin), Profile, Login/Logout -->
    <div class="nav-right">
      {% if user.is_authenticated %}

        {% if user.is_staff %}
          <a href="{% url 'posting:export_data' %}" class="nav-link">
            Export Data
          </a>
        {% endif %}

        <figure style="display:flex; flex-direction:column; align-items:center;">
        <a href="{% url 'profile_redirect' %}">
          <img src="{{ user.profile.avatar_url }}"
            alt="Profile photo"
            style="width:40px; height:40px; border-radius:50%; object-fit:cover;">
      </a>
     <figcaption style="margin-top: 1px; font-size: 10px; color: #ffffff;">
        {{ user.profile.display_name }}
      </figcaption>
      </figure>

        <a href="{% url 'account_logout' %}" class="nav-link">Log Out</a>

      {% else %}
        <a href="{% url 'loginpage:login' %}" class="nav-link">Log In</a>
      {% endif %}
    </div>

  </div>
</nav>
{% endwith %}
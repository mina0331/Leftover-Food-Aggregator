{% load static %}
{% with p=request.path %}
<nav style="width:100%; background:#232D4B; color:#fff; padding:10px 16px; box-sizing:border-box; position:relative; z-index:1000;">
  <style>
    .nav-inner{
      display:flex;
      align-items:center;
      gap:16px;
      position:relative; /* for absolute center */
    }

    .nav-left{
      display:flex;
      align-items:center;
      gap:10px;
    }

    /* Center tabs centered relative to full navbar */
    .nav-center{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      display:flex;
      justify-content:center;
      pointer-events:auto;
    }

    .nav-right{
      display:flex;
      gap:1px;
      align-items:center;
      margin-left:auto;
    }

    .nav-list{
      list-style:none;
      display:flex;
      gap:18px;
      margin:0;
      padding:0;
      align-items:center;
      flex-wrap:wrap;
    }

    /* Brand */
    .brand{
      display:inline-flex;
      align-items:center;
      gap:10px;
      text-decoration:none;
      padding:6px 10px;
      border-radius:6px;
      color:#fff;
      position:relative;
      transition:transform .2s, opacity .2s, color .2s;
    }

    .nav-link{
      display:inline-block;
      text-decoration:none;
      padding:6px 10px;
      border-radius:6px;
      color:#fff;
      position:relative;
      transition:transform .2s, opacity .2s, color .2s;
    }

    .nav-link:hover, .brand:hover{
      transform:translateY(-3px);
      opacity:.9;
    }

    .nav-link::after, .brand::after{
      content:"";
      position:absolute;
      left:0;
      bottom:-2px;
      height:3px;
      width:0;
      background:#E57200;
      transition:width .25s;
    }

    .nav-link:hover::after, .brand:hover::after{
      width:100%;
    }

    .active-link{
      color:#E57200 !important;
      font-weight:bold;
    }
    .active-link::after{
      width:100%;
    }

    .badge{
      background:#E57200;
      color:#fff;
      border-radius:10px;
      padding:2px 6px;
      font-size:12px;
      margin-left:6px;
    }

    @media (max-width: 900px){
      .nav-center{
        left:0;
        transform:none;
      }
    }
    .nav-profile {
    display:flex;
    flex-direction:column;
    align-items:center;
    margin-right:12px;
  }

  .nav-profile img {
    width:30px;
    height:30px;
    border-radius:50%;
    object-fit:cover;
    border:2px solid #E57200;
    box-shadow:0 1px 4px rgba(0,0,0,0.4);
  }

  .nav-profile-name {
    margin-top:4px;
    font-size:11px;
    font-weight:700;
    color:#ffffff;
    letter-spacing:0.4px;
    max-width:110px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;

    /* pill effect */
    padding:2px 8px;
    border-radius:999px;
    background:rgba(255,255,255,0.12);
    backdrop-filter:blur(3px);
    box-shadow:0 1px 3px rgba(0,0,0,0.35);
  }

  .btn-orange {
    padding:6px 14px;
    background:#E57200;
    color:white;
    border-radius:8px;
    font-weight:600;
    text-decoration:none;
    border:none;
    transition:background .2s, transform .1s, box-shadow .1s;
    display:inline-flex;
    align-items:center;
    gap:6px;
  }

  .btn-orange:hover {
    background:#c96000;
    transform:translateY(-1px);
    box-shadow:0 2px 6px rgba(0,0,0,0.3);
  }

  .btn-orange-icon {
    font-size:14px;
    line-height:1;
  }
  </style>


  <div class="nav-inner">

    <!-- LEFT: Brand -->
    <div class="nav-left">
      <a href="/" class="brand {% if p == '/' %}active-link{% endif %}">
        <img src="{% static 'img/image.png' %}" alt="UVA Leftovers Logo"
             style="height:28px;width:28px;object-fit:contain;">
        <span style="font-weight:700; letter-spacing:.3px;">UVA Leftovers</span>
      </a>
    </div>

    <!-- CENTER NAV -->
    {% url 'posting:post_list' as posts_url %}
    <div class="nav-center">
      <ul class="nav-list">


        {% if user.is_authenticated %}
          {% with role=user.profile.role %}
            {% if role == 'student' %}
              <li>
                <a href="{{ posts_url }}"
                   class="nav-link {% if p == posts_url or '/student' in p %}active-link{% endif %}">
                  Food Listings
                </a>
                {% if unread_posts_count %}
                  <span class="badge">{{ unread_posts_count }}</span>
                {% endif %}
              </li>
            {% elif role == 'org' %}
              <li>
                <a href="{{ posts_url }}"
                   class="nav-link {% if p == posts_url or '/provider' in p %}active-link{% endif %}">
                  Post Listings
                </a>
              </li>
            {% endif %}
          {% endwith %}
        

        {% url 'posting:event_history' as history_url %}
        <li>
          <a href="{{ history_url }}"
             class="nav-link {% if '/posts/history' in p %}active-link{% endif %}">
             Event History
          </a>
        </li>

        <li>
          {% url 'chat:index' as chat_url %}
          <a href="{{ chat_url }}"
             class="nav-link {% if p|slice:':6' == '/chat/' or p|slice:':9' == '/chat/' %}active-link{% endif %}">
             Chat
          </a>
          {% if unread_count %}
            <span class="badge">{{ unread_count }}</span>
          {% endif %}
        </li>

        <li>
          {% url 'friends:friends_list' as friends_url %}
          <a href="{{ friends_url }}"
             class="nav-link {% if p|slice:':9' == '/friends/' %}active-link{% endif %}">
             Friends
          </a>
          {% if pending_friend_requests_count %}
            <span class="badge">{{ pending_friend_requests_count }}</span>
          {% endif %}
        </li>
    {% if user.profile.role == 'org' %}
    <li class="nav-item" style="position:relative;">
  <a href="{% url 'posting:notification_inbox' %}"
     class="nav-link"
     style="
       display:flex;
       align-items:center;
       gap:4px;
       padding:6px 12px;
       border-radius:12px;
       transition: background 0.2s ease;
     ">

    <i class="fa-regular fa-message"></i>

    <span>Notifications</span>

    {% if notification_count %}
      <span class="badge"
            style="
              position:absolute;
              top:2px;
              right:2px;
              background:#E57200;
              color:white;
              padding:3px 7px;
              border-radius:12px;
              font-size:0.7rem;
              font-weight:600;
              box-shadow:0 2px 4px rgba(0,0,0,0.2);
            ">
        {{ notification_count }}
      </span>
    {% endif %}
    {% endif %}
    {% endif %}
  </a>
</li>


      </ul>
    </div>

    <!-- RIGHT: Export (admin), Profile, Login/Logout -->
    <div class="nav-right">
      {% if user.is_authenticated %}

        {% if user.is_staff %}
          <a href="{% url 'posting:export_data' %}" class="nav-link">
            Export Data
          </a>
        {% endif %}

        <figure style="display:flex; flex-direction:column; align-items:center;">

  <a href="{% url 'profile_redirect' %}">
    <img src="{{ user.profile.avatar_url }}"
      alt="Profile photo"
      style="width:35px; height:35px; border-radius:50%; object-fit:cover; border:2px solid #E57200;">
  </a>

  <figcaption style="
      margin-top: 4px;
      font-size: 10px;
      font-weight: 600;
      color: #ffffff;
      text-shadow: 0 1px 3px rgba(0,0,0,0.4);
      letter-spacing: 0.3px;
    ">
    {{ user.profile.display_name }}
  </figcaption>
</figure>


        <a href="{% url 'account_logout' %}"
   class="nav-link"
   style="
      padding:6px 14px;
      background:#E57200;
      color:white;
      border-radius:8px;
      font-weight:600;
      text-decoration:none;
      transition:all .2s;
   "
   onmouseover="this.style.background='#c96000'; this.style.transform='translateY(-1px)';"
   onmouseout="this.style.background='#E57200'; this.style.transform='none';">
  Log Out
</a>


      {% else %}
        <a href="{% url 'loginpage:login' %}" class="nav-link"
        style="
      padding:6px 14px;
      background:#E57200;
      color:white;
      border-radius:8px;
      font-weight:600;
      text-decoration:none;
      transition:all .2s;
      "
      >Log In</a>
      {% endif %}
    </div>

  </div>
</nav>
{% endwith %}